package kr.co.sist.dao;

import java.io.IOException;
import java.io.Reader;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;
import org.springframework.stereotype.Component;

@Component
public class MyBatisDAO {
//	private static MyBatisDAO mbDAO;
	private static SqlSessionFactory ssf; //싱글톤 사용권장 => 비용절감,일관성 유지,관리 용이

	private MyBatisDAO() {
		org.apache.ibatis.logging.LogFactory.useLog4J2Logging();
	}
	
//	public static MyBatisDAO getInstance() {
//		if(mbDAO == null) {
//			mbDAO = new MyBatisDAO();
//		}
//		return mbDAO;
//	}//getInstance
	
	/**
	 * SqlSessionFactory는 비용절감,일관성유지, 관리의 용이성을 위해서 Singleton Pattern으로 사용
	 * @return
	 */
	 static{ //static 영역 :  호출하지 않고 클래스가생서되면 자동호출 되는 영역.
		if(ssf == null) {
			try {
				//1. 설정파일과 연결
				Reader reader = Resources.getResourceAsReader("kr/co/sist/dao/mybatis-config.xml");
				//2. MyBatis Framework 생성
				ssf = new SqlSessionFactoryBuilder().build(reader);
				//3. 스트림 닫기
				if (reader != null) {reader.close();} //end if
				
			} catch (IOException e) {
				e.printStackTrace();
			}//end catch
		}//end if
	}//getSessionFactory
	
	public SqlSession getMyBatisHandler(boolean autoCommit) {
		return ssf.openSession(autoCommit);
	}//getMyBatisHandler
	
	public void closeHandler(SqlSession ss) {
		if(ss != null) {ss.close();} //end if
	}
}
